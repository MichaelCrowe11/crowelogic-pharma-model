# CroweLogic-Pharma with NeuroDebian Integration
# Combines pharmaceutical AI with neuroscience research tools

FROM neurodebian:bookworm

# Metadata
LABEL maintainer="michael@crowelogic.com"
LABEL description="CroweLogic-Pharma pharmaceutical AI with neuroscience tools"
LABEL version="2.0-neurodebian"

# Install system dependencies
RUN apt-get update && apt-get install -y \
    curl \
    wget \
    git \
    python3 \
    python3-pip \
    python3-dev \
    build-essential \
    && rm -rf /var/lib/apt/lists/*

# Install Ollama
RUN curl -fsSL https://ollama.com/install.sh | sh

# Install Python packages for pharmaceutical research
RUN pip3 install --no-cache-dir \
    fastapi \
    uvicorn \
    requests \
    pydantic \
    numpy \
    pandas \
    scipy \
    rdkit-pypi \
    biopython \
    scikit-learn

# Install neuroscience-specific Python packages
RUN pip3 install --no-cache-dir \
    nibabel \
    nilearn \
    neuroimaging \
    mne \
    pybrain

# Optional: Install key neuroscience tools from NeuroDebian
# Uncomment based on needs:
# RUN apt-get update && apt-get install -y \
#     fsl-core \
#     afni \
#     ants \
#     && rm -rf /var/lib/apt/lists/*

# Create app directory
WORKDIR /app

# Copy model files
COPY models/CroweLogicPharmaModelfile /app/Modelfile

# Copy API server (we'll create enhanced version)
COPY azure_deployment/api_server_neurodebian.py /app/api_server.py
COPY azure_deployment/startup.sh /app/startup.sh

RUN chmod +x /app/startup.sh

# Expose ports
EXPOSE 11434 8000

# Health check
HEALTHCHECK --interval=30s --timeout=10s --start-period=60s --retries=3 \
    CMD curl -f http://localhost:8000/health || exit 1

# Start services
CMD ["/app/startup.sh"]
